<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - PPN Tegalsari</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header with Logo -->
    <header class="ppn-header">
        <div class="container-fluid">
            <a href="/" class="header-link">
                <div class="header-content">
                    <div class="logo-section">
                        <img src="/images/logo.png" alt="Logo PPN Tegalsari" class="ppn-logo">
                    </div>
                    <div class="institution-section">
                        <h1>PELABUHAN PERIKANAN NUSANTARA</h1>
                        <h2>TEGALSARI</h2>
                    </div>
                </div>
            </a>
        </div>
    </header>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand">‚öôÔ∏è Admin Panel</span>
            <div class="ms-auto">
                <a href="/" class="btn btn-sm btn-outline-light fw-bold me-2">üè† Beranda</a>
                <a href="/login" class="btn btn-sm btn-light fw-bold">üö™ Logout</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-main">
        <!-- Page Header -->
        <div class="page-header">
            <h1>‚öôÔ∏è Admin Panel</h1>
            <p>Kelola data pelaporan harian dan ikan</p>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer"></div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs mb-4" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="laporanTab" data-bs-toggle="tab" data-bs-target="#laporanContent" type="button">
                    üìã Input Infografis
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="ikanTab" data-bs-toggle="tab" data-bs-target="#ikanContent" type="button">
                    üêü Input Ikan
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="googleSheetsTab" data-bs-toggle="tab" data-bs-target="#googleSheetsContent" type="button">
                    üìä Google Sheets
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="adminTabContent">
            <!-- Laporan Tab -->
            <div class="tab-pane fade show active" id="laporanContent" role="tabpanel">
                <div class="card mb-4">
                    <div class="card-header">üìù Form Input Data Harian</div>
                    <div class="card-body">
                        <form id="formLaporan" onsubmit="submitForm(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="tanggal">Tanggal *</label>
                                    <input type="date" id="tanggal" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="stblkk">STBLKK</label>
                                    <input type="number" id="stblkk" class="form-control" value="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="pb">PB</label>
                                    <input type="number" id="pb" class="form-control" value="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="asuransi_baru">Asuransi Baru</label>
                                    <input type="number" id="asuransi_baru" class="form-control" value="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="asuransi_lama">Asuransi Lama</label>
                                    <input type="number" id="asuransi_lama" class="form-control" value="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bbm_subsidi_surat">BBM Subsidi Surat</label>
                                    <input type="number" id="bbm_subsidi_surat" class="form-control" value="0">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bbm_non_surat">BBM Non Surat</label>
                                    <input type="number" id="bbm_non_surat" class="form-control" value="0">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Simpan Data</button>
                        </form>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="card">
                    <div class="card-header">üìä Data Infografis</div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th class="text-end">STBLKK</th>
                                        <th class="text-end">PB</th>
                                        <th class="text-end">Asuransi Baru</th>
                                        <th class="text-end">Asuransi Lama</th>
                                        <th class="text-end">BBM Subsidi</th>
                                        <th class="text-end">BBM Non Surat</th>
                                        <th class="text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="tableLaporanBody">
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">Memuat data...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        <div class="tab-pane fade" id="ikanContent" role="tabpanel">
            <!-- Form Input Section -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-header">üìù Form Input/Edit Ikan</div>
                        <div class="card-body">
                            <form id="formIkan" onsubmit="submitFormIkan(event)">
                                <div class="form-group mb-3">
                                    <label class="form-label" for="namaIkan">Nama Ikan *</label>
                                    <input type="text" id="namaIkan" class="form-control" placeholder="Contoh: Ikan Lele" required>
                                    <small class="text-muted">Masukkan nama jenis ikan</small>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="jumlahIkan">Jumlah (ekor) *</label>
                                    <input type="number" id="jumlahIkan" class="form-control" min="1" placeholder="0" required>
                                    <small class="text-muted">Masukkan jumlah ikan dalam ekor</small>
                                </div>

                                <div class="form-group mb-3">
                                    <label class="form-label" for="fotoIkan">üì∏ Foto Ikan</label>
                                    <input type="file" id="fotoIkan" class="form-control" accept="image/*">
                                    <small class="text-muted">Format: JPG, PNG, GIF (Max 5MB) - Opsional</small>
                                </div>

                                <div class="form-group mb-3">
                                    <div id="previewFoto"></div>
                                </div>

                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        üíæ Simpan Data Ikan
                                    </button>
                                    <button type="reset" class="btn btn-secondary" onclick="resetFormIkan()">Reset Form</button>
                                </div>

                                <div id="editInfo" style="display: none; margin-top: 1rem;">
                                    <div class="alert alert-info mb-0">
                                        <small>
                                            ‚úèÔ∏è Mode Edit - Klik "Reset Form" untuk membuat data baru
                                            <button type="button" class="btn-close btn-sm float-end" onclick="resetFormIkan()" style="padding: 0;"></button>
                                        </small>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Preview & Info Section -->
                <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-header">‚ÑπÔ∏è Informasi Data Ikan</div>
                        <div class="card-body text-center">
                            <div id="infoContent">
                                <p class="text-muted">Isi form di sebelah kiri untuk melihat preview data</p>
                                <div style="font-size: 4rem; color: #ccc;">üêü</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">üìä Statistik Ikan</div>
                        <div class="card-body">
                            <div class="mb-3">
                                <small class="text-muted">TOTAL JENIS IKAN</small>
                                <div style="font-size: 2rem; font-weight: bold; color: #1e3a8a;" id="statTotal">0</div>
                            </div>
                            <div class="mb-3">
                                <small class="text-muted">TOTAL EKOR IKAN</small>
                                <div style="font-size: 2rem; font-weight: bold; color: #10b981;" id="statEkor">0</div>
                            </div>
                            <button class="btn btn-outline-primary btn-sm w-100" onclick="loadIkanDataList()">
                                üîÑ Refresh Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table Section -->
            <div class="card mt-4">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>üêü Daftar Ikan yang Sudah Diinput</span>
                        <button class="btn btn-primary btn-sm" onclick="loadIkanDataList()">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>Nama Ikan</th>
                                <th class="text-end">Jumlah (ekor)</th>
                                <th>Tanggal Input</th>
                                <th class="text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tableIkanBody">
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">Memuat data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    
    </div>

    

        <!-- Google Sheets Tab -->
        <div class="tab-pane fade" id="googleSheetsContent" role="tabpanel">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üì° Status Koneksi Google Sheets</h5>
                </div>
                <div class="card-body">
                    <div id="gsConnectionStatus" class="alert alert-warning" role="alert">
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        Mengecek koneksi...
                    </div>
                </div>
            </div>

            <!-- Google Sheets Tabs -->
            <ul class="nav nav-tabs mb-4" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="gsLaporanTab" data-bs-toggle="tab" data-bs-target="#gsLaporanContent" type="button">
                        üìã Data Laporan Harian
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="gsIkanTab" data-bs-toggle="tab" data-bs-target="#gsIkanContent" type="button">
                        üêü Data Ikan
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="gsSyncTab" data-bs-toggle="tab" data-bs-target="#gsSyncContent" type="button">
                        üîÑ Sinkronisasi
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <!-- Google Sheets Laporan -->
                <div class="tab-pane fade show active" id="gsLaporanContent" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">üìã Data Infografis dari Google Sheets</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="gsLaporanTable">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>Waktu</th>
                                            <th>Tanggal</th>
                                            <th>Data Tangkapan</th>
                                            <th>Data Layanan</th>
                                            <th>Catatan</th>
                                        </tr>
                                    </thead>
                                    <tbody id="gsLaporanTableBody">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">
                                                <span class="spinner-border spinner-border-sm me-2"></span>
                                                Mengambil data...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-primary btn-sm" onclick="refreshGSLaporanData()">
                                    üîÑ Refresh
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="clearGSLaporanSheet()">
                                    üóëÔ∏è Clear Sheet
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Google Sheets Ikan -->
                <div class="tab-pane fade" id="gsIkanContent" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">üêü Data Ikan dari Google Sheets</div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="gsIkanTable">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>Waktu Sync</th>
                                            <th>ID Ikan</th>
                                            <th>Nama Ikan</th>
                                            <th>Harga Estimasi</th>
                                            <th>Stok</th>
                                            <th>Asal</th>
                                        </tr>
                                    </thead>
                                    <tbody id="gsIkanTableBody">
                                        <tr>
                                            <td colspan="7" class="text-center text-muted">
                                                <span class="spinner-border spinner-border-sm me-2"></span>
                                                Mengambil data...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-primary btn-sm" onclick="refreshGSIkanData()">
                                    üîÑ Refresh
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="clearGSIkanSheet()">
                                    üóëÔ∏è Clear Sheet
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Google Sheets Sync -->
                <div class="tab-pane fade" id="gsSyncContent" role="tabpanel">
                    <div class="card mb-4">
                        <div class="card-header">üîÑ Opsi Sinkronisasi</div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">üì• Sync dari Aplikasi ke Sheet</h6>
                                            <p class="text-muted small">Kirim semua data infografis ke Google Sheets</p>
                                            <button class="btn btn-success w-100" onclick="syncAllToSheet()">
                                                Sync Laporan
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">üì§ Import dari Sheet ke Aplikasi</h6>
                                            <p class="text-muted small">Ambil data dari Google Sheets ke database</p>
                                            <button class="btn btn-info w-100" onclick="importFromSheet()">
                                                Import dari Sheet
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4">

                            <h6 class="mb-3">Manual Sync Data</h6>
                            <form id="manualSyncForm">
                                <div class="mb-3">
                                    <label class="form-label">Tipe Data</label>
                                    <select class="form-select" id="syncType" required>
                                        <option value="">-- Pilih Tipe Data --</option>
                                        <option value="laporan">Infografis</option>
                                        <option value="ikan">Data Ikan</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Data (JSON)</label>
                                    <textarea class="form-control" id="syncData" rows="6" 
                                        placeholder='{"id": "001", ...}'></textarea>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    ‚ûï Sync Data
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    <div class="footer">
        <p>&copy; 2025 PPN Tegalsari. Semua hak dilindungi.</p>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="/js/admin.js"></script>
    
    <!-- Google Sheets Integration Script -->
    <script>
        // Check connection status
        async function checkGSConnectionStatus() {
            try {
                const response = await fetch('/api/data-sheet/laporan-harian');
                const result = await response.json();

                if (result.success) {
                    const status = document.getElementById('gsConnectionStatus');
                    status.innerHTML = '';
                    const span = document.createElement('span');
                    span.className = 'badge bg-success';
                    span.textContent = '‚úÖ Terhubung ke Google Sheets';
                    status.appendChild(span);
                    refreshGSLaporanData();
                    refreshGSIkanData();
                } else {
                    throw new Error('Koneksi gagal');
                }
            } catch (error) {
                    const status = document.getElementById('gsConnectionStatus');
                    status.innerHTML = '';
                    const span = document.createElement('span');
                    span.className = 'badge bg-warning';
                    span.textContent = '‚ö†Ô∏è Google Sheets tidak tersedia: ' + error.message;
                    status.appendChild(span);
            }
        }

        // Refresh laporan data dari Google Sheets
        async function refreshGSLaporanData() {
            try {
                const response = await fetch('/api/data-sheet/laporan-harian');
                const result = await response.json();

                if (result.success) {
                    const tbody = document.getElementById('gsLaporanTableBody');
                    tbody.innerHTML = '';

                    if (result.data && result.data.length > 0) {
                        result.data.forEach((row, index) => {
                            const tr = document.createElement('tr');

                            const tdIndex = document.createElement('td');
                            tdIndex.textContent = index + 1;
                            tr.appendChild(tdIndex);

                            const makeCell = (value) => {
                                const td = document.createElement('td');
                                td.textContent = value != null && value !== '' ? value : '-';
                                return td;
                            };

                            tr.appendChild(makeCell(row[0]));
                            tr.appendChild(makeCell(row[1]));

                            const tdSmall2 = document.createElement('td');
                            const small2 = document.createElement('small');
                            small2.textContent = row[2] != null && row[2] !== '' ? row[2] : '-';
                            tdSmall2.appendChild(small2);
                            tr.appendChild(tdSmall2);

                            const tdSmall3 = document.createElement('td');
                            const small3 = document.createElement('small');
                            small3.textContent = row[3] != null && row[3] !== '' ? row[3] : '-';
                            tdSmall3.appendChild(small3);
                            tr.appendChild(tdSmall3);

                            tr.appendChild(makeCell(row[4]));

                            tbody.appendChild(tr);
                        });
                    } else {
                        const tr = document.createElement('tr');
                        const td = document.createElement('td');
                        td.setAttribute('colspan', '6');
                        td.className = 'text-center text-muted';
                        td.textContent = 'Tidak ada data';
                        tr.appendChild(td);
                        tbody.appendChild(tr);
                    }
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Refresh ikan data dari Google Sheets
        async function refreshGSIkanData() {
            try {
                const response = await fetch('/api/data-sheet/ikan');
                const result = await response.json();

                if (result.success) {
                    const tbody = document.getElementById('gsIkanTableBody');
                    tbody.innerHTML = '';

                    if (result.data && result.data.length > 0) {
                        result.data.forEach((row, index) => {
                            const tr = document.createElement('tr');

                            const tdIndex = document.createElement('td');
                            tdIndex.textContent = index + 1;
                            tr.appendChild(tdIndex);

                            const makeCell = (value) => {
                                const td = document.createElement('td');
                                td.textContent = value != null && value !== '' ? value : '-';
                                return td;
                            };

                            tr.appendChild(makeCell(row[0]));
                            tr.appendChild(makeCell(row[1]));
                            tr.appendChild(makeCell(row[2]));
                            tr.appendChild(makeCell(row[3]));
                            tr.appendChild(makeCell(row[4]));
                            tr.appendChild(makeCell(row[5]));

                            tbody.appendChild(tr);
                        });
                    } else {
                        const tr = document.createElement('tr');
                        const td = document.createElement('td');
                        td.setAttribute('colspan', '7');
                        td.className = 'text-center text-muted';
                        td.textContent = 'Tidak ada data';
                        tr.appendChild(td);
                        tbody.appendChild(tr);
                    }
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Clear laporan sheet
        async function clearGSLaporanSheet() {
            if (!confirm('Apakah Anda yakin ingin menghapus semua data di sheet ini?')) return;

            try {
                const response = await fetch('/api/data-sheet/clear/Laporan%20Harian', {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ Sheet berhasil dikosongkan', 'success');
                    refreshGSLaporanData();
                } else {
                    showAlert('‚ùå Error: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'danger');
            }
        }

        // Clear ikan sheet
        async function clearGSIkanSheet() {
            if (!confirm('Apakah Anda yakin ingin menghapus semua data di sheet ini?')) return;

            try {
                const response = await fetch('/api/data-sheet/clear/Data%20Ikan', {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ Sheet berhasil dikosongkan', 'success');
                    refreshGSIkanData();
                } else {
                    showAlert('‚ùå Error: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'danger');
            }
        }

        // Sync all to sheet (placeholder)
        async function syncAllToSheet() {
            showAlert('‚ö†Ô∏è Fitur sync bulk belum diimplementasikan', 'info');
        }

        // Import from sheet (placeholder)
        async function importFromSheet() {
            showAlert('‚ö†Ô∏è Fitur import belum diimplementasikan', 'info');
        }

        // Manual sync
        document.getElementById('manualSyncForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const type = document.getElementById('syncType').value;
            const data = document.getElementById('syncData').value;

            try {
                const parsedData = JSON.parse(data);
                const endpoint = type === 'laporan' ? 
                    '/api/data-sheet/sync-laporan-harian' : 
                    '/api/data-sheet/sync-ikan';

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(parsedData)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ Data berhasil disync', 'success');
                    document.getElementById('manualSyncForm').reset();
                    if (type === 'laporan') {
                        refreshGSLaporanData();
                    } else {
                        refreshGSIkanData();
                    }
                } else {
                    showAlert('‚ùå Error: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'danger');
            }
        });

        // Initialize Google Sheets on page load
        window.addEventListener('load', () => {
            checkGSConnectionStatus();
            // Load ikan data saat tab ikan di-klik
            loadIkanDataList();
        });

        // ============ FUNCTIONS UNTUK INPUT IKAN ============

        // Submit form ikan
        async function submitFormIkan(event) {
            event.preventDefault();

            const namaIkan = document.getElementById('namaIkan').value;
            const jumlahIkan = document.getElementById('jumlahIkan').value;
            const fotoIkan = document.getElementById('fotoIkan').files[0];

            if (!namaIkan || !jumlahIkan) {
                showAlert('‚ùå Nama dan jumlah ikan harus diisi', 'danger');
                return;
            }

            const formData = new FormData();
            formData.append('nama_ikan', namaIkan);
            formData.append('jumlah', jumlahIkan);
            if (fotoIkan) {
                formData.append('foto', fotoIkan);
            }

            try {
                const response = await fetch('/api/ikan', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ Data ikan berhasil disimpan', 'success');
                    resetFormIkan();
                    loadIkanDataList();
                } else {
                    showAlert('‚ùå Error: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('‚ùå Error: ' + error.message, 'danger');
            }
        }

        // Load ikan data list
        async function loadIkanDataList() {
            try {
                const response = await fetch('/api/ikan');
                const result = await response.json();

                if (result.success) {
                    const tbody = document.getElementById('tableIkanBody');
                    tbody.innerHTML = '';

                    let totalJenis = 0;
                    let totalEkor = 0;

                    if (result.data && result.data.length > 0) {
                        result.data.forEach(ikan => {
                            totalJenis++;
                            totalEkor += parseInt(ikan.jumlah) || 0;

                            const tanggalInput = new Date(ikan.created_at).toLocaleDateString('id-ID');
                            const tr = document.createElement('tr');

                            const tdFoto = document.createElement('td');
                            if (ikan.foto) {
                                const img = document.createElement('img');
                                img.src = ikan.foto;
                                img.style.height = '50px';
                                img.style.borderRadius = '5px';
                                tdFoto.appendChild(img);
                            } else {
                                const span = document.createElement('span');
                                span.className = 'text-muted';
                                span.textContent = '-';
                                tdFoto.appendChild(span);
                            }
                            tr.appendChild(tdFoto);

                            const tdNama = document.createElement('td');
                            tdNama.textContent = ikan.nama_ikan || '-';
                            tr.appendChild(tdNama);

                            const tdJumlah = document.createElement('td');
                            tdJumlah.className = 'text-end';
                            tdJumlah.textContent = (ikan.jumlah || 0) + ' ekor';
                            tr.appendChild(tdJumlah);

                            const tdTanggal = document.createElement('td');
                            tdTanggal.textContent = tanggalInput;
                            tr.appendChild(tdTanggal);

                            const tdAksi = document.createElement('td');
                            tdAksi.className = 'text-center';
                            const btnEdit = document.createElement('button');
                            btnEdit.className = 'btn btn-sm btn-warning';
                            btnEdit.type = 'button';
                            btnEdit.textContent = '‚úèÔ∏è';
                            btnEdit.addEventListener('click', () => editIkan(ikan.id));
                            const btnDel = document.createElement('button');
                            btnDel.className = 'btn btn-sm btn-danger';
                            btnDel.type = 'button';
                            btnDel.textContent = 'üóëÔ∏è';
                            btnDel.addEventListener('click', () => deleteIkan(ikan.id));
                            tdAksi.appendChild(btnEdit);
                            tdAksi.appendChild(btnDel);
                            tr.appendChild(tdAksi);

                            tbody.appendChild(tr);
                        });
                    } else {
                        const tr = document.createElement('tr');
                        const td = document.createElement('td');
                        td.setAttribute('colspan','5');
                        td.className = 'text-center text-muted py-4';
                        td.textContent = 'Belum ada data ikan';
                        tr.appendChild(td);
                        tbody.appendChild(tr);
                    }

                    document.getElementById('statTotal').innerText = totalJenis;
                    document.getElementById('statEkor').innerText = totalEkor.toLocaleString('id-ID');
                } else {
                    showAlert('‚ùå Error: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('‚ùå Error: ' + error.message, 'danger');
            }
        }

        // Reset form ikan
        function resetFormIkan() {
            document.getElementById('formIkan').reset();
            const preview = document.getElementById('previewFoto');
            if (preview) preview.textContent = '';
            const info = document.getElementById('infoContent');
            if (info) {
                info.innerHTML = '';
                const p = document.createElement('p');
                p.className = 'text-muted';
                p.textContent = 'Isi form di sebelah kiri untuk melihat preview data';
                const div = document.createElement('div');
                div.style.fontSize = '4rem';
                div.style.color = '#ccc';
                div.textContent = 'üêü';
                info.appendChild(p);
                info.appendChild(div);
            }
            document.getElementById('editInfo').style.display = 'none';
        }

        // Edit ikan (placeholder)
        function editIkan(id) {
            showAlert('‚ö†Ô∏è Fitur edit belum diimplementasikan', 'info');
        }

        // Delete ikan
        async function deleteIkan(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;

            try {
                const response = await fetch(`/api/ikan/${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ Data ikan berhasil dihapus', 'success');
                    loadIkanDataList();
                } else {
                    showAlert('‚ùå Error: ' + result.message, 'danger');
                }
            } catch (error) {
                showAlert('‚ùå Error: ' + error.message, 'danger');
            }
        }

        // Update preview foto
        document.addEventListener('change', function(e) {
            if (e.target.id === 'fotoIkan') {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById('previewFoto');
                        preview.innerHTML = '';
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.maxWidth = '100%';
                        img.style.maxHeight = '300px';
                        img.style.borderRadius = '10px';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        // Update info preview saat form berubah
        document.getElementById('namaIkan')?.addEventListener('change', function() {
            const nama = this.value;
            const jumlah = document.getElementById('jumlahIkan').value;
            if (nama) {
                const info = document.getElementById('infoContent');
                info.innerHTML = '';
                const h5 = document.createElement('h5');
                h5.textContent = nama;
                const p = document.createElement('p');
                p.textContent = `${jumlah} ekor`;
                const div = document.createElement('div');
                div.style.fontSize = '3rem';
                div.textContent = 'üêü';
                info.appendChild(h5);
                info.appendChild(p);
                info.appendChild(div);
            }
        });
    </script>
</body>
</html>
